Locomotive.Views.Inputs ||= {}

class Locomotive.Views.Inputs.RteView extends Backbone.View

  events:
    'click a.style':      'open_styles_dialog'
    # 'click a[data-wysihtml5-command=createLink]': 'open_link_dialog'

  initialize: ->
    $textarea             = @$('textarea')
    @$create_link_button  = @$('a[data-wysihtml5-command=createLink]')
    console.log $textarea.attr('id') #$textarea.attr('id')

    @editor = new wysihtml5.Editor 'content_entry_body',
      toolbar:        'wysihtml5-toolbar'
      useLineBreaks:  false
      parserRules:    wysihtml5ParserRules
      stylesheets:    ['<%= stylesheet_path("locomotive/wysihtml5_reset") %>', '<%= stylesheet_path("locomotive/wysihtml5_editor") %>']

    window.foo = @editor
    that = @

    setTimeout(
      -> that.create_link_view()
    , 200)

  render: ->
    # do nothing

  open_styles_dialog: (event) ->
    $button = $(event.target).closest('a')
    @$style_popover = @$style_popover || ($button.popover
      placement:  'bottom'
      content:    $button.next('.style-dialog-content').html()
      html:       true
      title:      undefined).popover('show')

  create_link_view: ->
    @link_view = new Locomotive.Views.Inputs.Rte.LinkView
      el:     @$('a[data-wysihtml5-command=createLink]')
      editor: @editor

    @link_view.render()

  remove: ->
    @link_view.remove()

  # open_link_dialog: (event) ->
  #   console.log '[open_link_dialog] start'
  #   true

  # create_link_dialog: ->
  #   editor  = @editor
  #   command = @editor.toolbar.commandMapping['createLink:null']

  #   popover_link = @$create_link_button.popover
  #     placement:  'bottom'
  #     content:    @$create_link_button.next('.link-dialog-content').html()
  #     html:       true
  #     title:      undefined

  #   dialog_proxy =
  #     show: (state) ->
  #       console.log('Opening new create link dialog')
  #       window.bar = state
  #       popover_link.popover('show')
  #     hide: ->
  #       console.log('Closing new create link dialog')
  #       popover_link.popover('hide')

  #   command.dialog = dialog_proxy


